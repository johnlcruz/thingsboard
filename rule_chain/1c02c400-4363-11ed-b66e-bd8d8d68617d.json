{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "1c02c400-4363-11ed-b66e-bd8d8d68617d"
    },
    "name" : "ECOPRO Alarms",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Post attributes"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 0,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 4,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 14,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 17,
      "type" : "True"
    }, {
      "fromIndex" : 3,
      "toIndex" : 24,
      "type" : "Created"
    }, {
      "fromIndex" : 3,
      "toIndex" : 24,
      "type" : "Updated"
    }, {
      "fromIndex" : 4,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 3,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "True"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 13,
      "type" : "True"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 16,
      "type" : "True"
    }, {
      "fromIndex" : 16,
      "toIndex" : 20,
      "type" : "Created"
    }, {
      "fromIndex" : 16,
      "toIndex" : 20,
      "type" : "Updated"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "True"
    }, {
      "fromIndex" : 20,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 20,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 24,
      "toIndex" : 21,
      "type" : "True"
    }, {
      "fromIndex" : 24,
      "toIndex" : 25,
      "type" : "False"
    }, {
      "fromIndex" : 25,
      "toIndex" : 23,
      "type" : "True"
    }, {
      "fromIndex" : 27,
      "toIndex" : 28,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 1,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1027,
        "layoutY" : 153
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureWater_status;\r\nvar temperature    = msg.temperatureWater;\r\nvar alarmType      = \"Temperatura da agua\";\r\nvar message        = \"Temperatura da agua em \" + temperature + \"°C\";\r\n\r\n\r\nif (isolatedStatus != \"OK\" && temperature > 30 && temperature < 50) {\r\n    var alertMessage  = \"Sensor de Temperatura em alerta\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nif (temperature < 30 || temperature > 50){\r\n    var alertMessage  = \"A temperatura da água está em ALERTA: \" + temperature + \"°C\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}  \r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "89943d90-5d4e-11ee-9559-2f8be92bafca"
      },
      "name" : "Water",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 289,
        "layoutY" : 148
      },
      "configuration" : {
        "version" : 0
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
      },
      "name" : "filter",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 731,
        "layoutY" : 151
      },
      "configuration" : {
        "originatorTypes" : [ "DEVICE", "CUSTOMER", "USER" ]
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4b5625e0-5d83-11ee-9559-2f8be92bafca"
      },
      "name" : "teste",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 154
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b7266050-5e0f-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme agua",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 253
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureDrum_status;\nvar temperature    = msg.temperatureDrum;\nvar alarmType      = \"Temperatura do tambor\";\nvar message        = \"Temperatura do tambor em \" + temperature + \"°C\";\n\n\n\nif (isolatedStatus != \"OK\" && temperature > 25 && temperature < 50) {\n    var alertMessage  = \"Sensor de Temperatura do tambor em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature < 25 || temperature > 50){\n    var alertMessage  = \"A temperatura do tambor está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03837c90-612f-11ee-9559-2f8be92bafca"
      },
      "name" : "Drum Temperature",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 155
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a070c1a0-6131-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1318,
        "layoutY" : 258
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a85c8260-6135-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1594,
        "layoutY" : 260
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "08b39860-6136-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme tambor",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 354
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureInternal_status;\nvar temperature    = msg.temperatureInternal;\nvar alarmType      = \"Temperatura do painel\";\n\nif (isolatedStatus != \"OK\" && temperature > 40 && temperature < 60) {\n    var alertMessage  = \"Sensor de Temperatura do painel em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature < 40 || temperature > 60){\n    var alertMessage  = \"A temperatura do painel está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };        \n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580630-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Painel Temperature",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1319,
        "layoutY" : 359
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580631-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1595,
        "layoutY" : 361
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9582d40-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme Painel",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 454
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus1 = msg.currentPhase01_A_status;\nvar isolatedStatus2 = msg.currentPhase02_A_status;\nvar isolatedStatus3 = msg.currentPhase03_A_status;\n\nvar Phase01 = msg.currentPhase01_A;\nvar Phase02 = msg.currentPhase02_A;\nvar Phase03 = msg.currentPhase03_A;\n\nvar temperature     = msg.temperatureInternal;\nvar alarmType       = \"Alertas de fases\";\nvar alertMessage    = \"Correntes do motor: \" \n                     + (parseFloat(Phase01) / 1000.0).toFixed(1) + \"A, \"\n                     + (parseFloat(Phase02) / 1000.0).toFixed(1) + \"A, \"\n                     + (parseFloat(Phase03) / 1000.0).toFixed(1) + \"A\";\n\n\nif (isolatedStatus1 != \"OK\" || isolatedStatus2 != \"OK\" || isolatedStatus3 != \"OK\" ) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a0-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 455
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a1-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1598,
        "layoutY" : 455
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a2-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 554
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.flowSensor_l_per_min_status;\nvar flow_per_min   = msg.flowSensor_l_per_min_instantly;\nvar flow_min_last  = msg.flowSensor_l_per_min_lastMinute; \nvar flow_last_15   = msg.flowSensor_l_per_min_last15Minutes; \n\nisolatedStatus = \"ALERTA\";\n\n    if(flow_per_min == 0 && flow_min_last == 0 && flow_last_15 == 0 ){\n        var alarmType      = \"Falta de água\";\n        var message        = \"Possivel falta, fluxo de água em \" + flow_per_min + \" l/min\";\n        var alarmCount     = true;\n        var isolatedStatus = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: message,\n            alarmType: alarmType,\n            alarmCount: alarmCount\n        };   \n    }else if (flow_per_min > 10){\n        var alarmType      = \"Vazão excessiva de água\";\n        var message        = \"Fluxo de água em \" + flow_per_min + \" l/min\";\n        var isolatedStatus = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: message,\n            alarmType: alarmType,\n        };   \n    }\n     \n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d0-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 555
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n        return true;\n}else{\n    return false;\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d1-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1599,
        "layoutY" : 554
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d2-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 653
      },
      "configuration" : {
        "jsScript" : "var currentWeight_kg = msg.currentWeight_kg;\nvar alarmType        = \"Excesso de peso\";\nvar alertMessage     = \"Peso atual em : \" + currentWeight_kg + \"Kg\";\nvar deviceName       = metadata.deviceName; // Obtém o valor do campo deviceName\nvar modeldevice      = deviceName.substring(0, 3); // Pega os 3 primeiros caracteres\nvar limit            = parseInt(modeldevice) + (parseInt(modeldevice)*0.2);//limit= modelo do equipamento + 20%\n\nif (currentWeight_kg > limit) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6920-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 654
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6921-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1598,
        "layoutY" : 654
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6922-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1918,
        "layoutY" : 554
      },
      "configuration" : {
        "jsScript" : "var elapsedMillis = msg.endTs - msg.startTs;\nvar elapsedMinutes = Math.floor(elapsedMillis / (1000 * 60));\n\nif (elapsedMinutes >= 30) {\n  // Dispare o alarme, pois passaram 15 minutos\n  // Reinicie o zeroTimestamp para futuras verificações\n  msg.currentTime = elapsedMinutes;\n  // Tome a ação adequada aqui, como criar um alarme\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f0c07aa0-6178-11ee-9559-2f8be92bafca"
      },
      "name" : "Count Time",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2149,
        "layoutY" : 153
      },
      "configuration" : {
        "fromTemplate" : "alertas@ecocircuito.com.br",
        "toTemplate" : "john.lennon@ecocircuito.com.br",
        "ccTemplate" : null,
        "bccTemplate" : null,
        "subjectTemplate" : "Biodigestor ${deviceName} em $[details.status.alarmType] ",
        "mailBodyType" : "false",
        "isHtmlTemplate" : null,
        "bodyTemplate" : "Biodigestor ${deviceName} em alarme:\nSTATUS: $[details.status.errorStatus]\nMENSAGEM: $[details.status.message]\nTIPO DO ALARME: $[details.status.alarmType] "
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bf37ba81-6181-11ee-9559-2f8be92bafca"
      },
      "name" : "envio teste",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2403,
        "layoutY" : 153
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpProtocol" : "smtp",
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "timeout" : 10000,
        "enableTls" : false,
        "tlsVersion" : "TLSv1.2",
        "enableProxy" : false,
        "proxyHost" : null,
        "proxyPort" : null,
        "proxyUser" : null,
        "proxyPassword" : null,
        "username" : null,
        "password" : null
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fb9c6ec0-6182-11ee-9559-2f8be92bafca"
      },
      "name" : "teste email",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2404,
        "layoutY" : 58
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    \n    //now metadata is the same as it comes IN this rule node\n}\n\n \nreturn details;",
        "alarmType" : "$[name]"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a770fff0-61f0-11ee-9559-2f8be92bafca"
      },
      "name" : "teste",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1912,
        "layoutY" : 155
      },
      "configuration" : {
        "jsScript" : "return msg.details.count == 10;"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "353a9da0-6200-11ee-9559-2f8be92bafca"
      },
      "name" : "FILTRO EMAIL",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2153,
        "layoutY" : 55
      },
      "configuration" : {
        "jsScript" : "return msg.details.count > 10;"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f89f9a50-6202-11ee-9559-2f8be92bafca"
      },
      "name" : "FILTRO LIMPEZA",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2180,
        "layoutY" : 476
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "$[name]"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e211c270-6204-11ee-9559-2f8be92bafca"
      },
      "name" : "Limpeza",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2182,
        "layoutY" : 553
      },
      "configuration" : {
        "fromTemplate" : "alertas@ecocircuito.com.br",
        "toTemplate" : "john.lennon@ecocircuito.com.br",
        "ccTemplate" : null,
        "bccTemplate" : null,
        "subjectTemplate" : "Biodigestor ${deviceName} em $[details.status.alarmType] ",
        "mailBodyType" : "false",
        "isHtmlTemplate" : null,
        "bodyTemplate" : "Biodigestor ${deviceName} em alarme:\nSTATUS: $[details.status.errorStatus]\nMENSAGEM: $[details.status.message]\nTIPO DO ALARME: $[details.status.alarmType] "
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b08fd9c0-6205-11ee-9559-2f8be92bafca"
      },
      "name" : "envio teste",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2436,
        "layoutY" : 553
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpProtocol" : "smtp",
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "timeout" : 10000,
        "enableTls" : false,
        "tlsVersion" : "TLSv1.2",
        "enableProxy" : false,
        "proxyHost" : null,
        "proxyPort" : null,
        "proxyUser" : null,
        "proxyPassword" : null,
        "username" : null,
        "password" : null
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b08fd9c1-6205-11ee-9559-2f8be92bafca"
      },
      "name" : "teste email",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}