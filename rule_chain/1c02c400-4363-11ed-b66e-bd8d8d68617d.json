{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "1c02c400-4363-11ed-b66e-bd8d8d68617d"
    },
    "name" : "ECOPRO Alarms",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Post attributes"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Timeseries Updated"
    }, {
      "fromIndex" : 2,
      "toIndex" : 0,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 4,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 14,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 17,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 22,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 32,
      "type" : "True"
    }, {
      "fromIndex" : 3,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 3,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 4,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 3,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 7,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 7,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "True"
    }, {
      "fromIndex" : 10,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 10,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 13,
      "type" : "True"
    }, {
      "fromIndex" : 13,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 13,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 16,
      "type" : "True"
    }, {
      "fromIndex" : 16,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 16,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "True"
    }, {
      "fromIndex" : 19,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 19,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 21,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 27,
      "type" : "Failure"
    }, {
      "fromIndex" : 22,
      "toIndex" : 23,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 26,
      "type" : "True"
    }, {
      "fromIndex" : 23,
      "toIndex" : 31,
      "type" : "False"
    }, {
      "fromIndex" : 24,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 24,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 25,
      "toIndex" : 30,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 24,
      "type" : "True"
    }, {
      "fromIndex" : 26,
      "toIndex" : 28,
      "type" : "False"
    }, {
      "fromIndex" : 28,
      "toIndex" : 25,
      "type" : "Created"
    }, {
      "fromIndex" : 28,
      "toIndex" : 25,
      "type" : "Updated"
    }, {
      "fromIndex" : 30,
      "toIndex" : 29,
      "type" : "True"
    }, {
      "fromIndex" : 32,
      "toIndex" : 34,
      "type" : "Success"
    }, {
      "fromIndex" : 33,
      "toIndex" : 21,
      "type" : "Created"
    }, {
      "fromIndex" : 33,
      "toIndex" : 21,
      "type" : "Updated"
    }, {
      "fromIndex" : 34,
      "toIndex" : 33,
      "type" : "True"
    } ],
    "firstNodeIndex" : 1,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1027,
        "layoutY" : 153
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureWater_status;\r\nvar temperature    = msg.temperatureWater;\r\nvar alarmType      = \"Temperatura da agua\";\r\nvar message        = \"Temperatura da agua em \" + temperature + \"°C\";\r\n\r\n\r\nif (isolatedStatus != \"OK\" && temperature > 30 && temperature < 50) {\r\n    var alertMessage  = \"Sensor de Temperatura em alerta\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nif (temperature < 30 || temperature > 50){\r\n    var alertMessage  = \"A temperatura da água está em ALERTA: \" + temperature + \"°C\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}  \r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "89943d90-5d4e-11ee-9559-2f8be92bafca"
      },
      "name" : "Water",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 289,
        "layoutY" : 148
      },
      "configuration" : {
        "version" : 0
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
      },
      "name" : "filter",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 731,
        "layoutY" : 151
      },
      "configuration" : {
        "originatorTypes" : [ "DEVICE", "CUSTOMER", "USER" ]
      },
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4b5625e0-5d83-11ee-9559-2f8be92bafca"
      },
      "name" : "teste",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 154
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b7266050-5e0f-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme agua",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 253
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureDrum_status;\nvar temperature    = msg.temperatureDrum;\nvar alarmType      = \"Temperatura do tambor\";\nvar message        = \"Temperatura do tambor em \" + temperature + \"°C\";\n\n\n\nif (isolatedStatus != \"OK\" && temperature > 25 && temperature < 50) {\n    var alertMessage  = \"Sensor de Temperatura do tambor em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature < 25 || temperature > 50){\n    var alertMessage  = \"A temperatura do tambor está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03837c90-612f-11ee-9559-2f8be92bafca"
      },
      "name" : "Drum Temperature",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 155
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a070c1a0-6131-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1318,
        "layoutY" : 258
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a85c8260-6135-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 260
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "08b39860-6136-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme tambor",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 354
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureInternal_status;\nvar temperature    = msg.temperatureInternal;\nvar alarmType      = \"Temperatura do painel\";\n\nif (isolatedStatus != \"OK\" && temperature > 40 && temperature < 60) {\n    var alertMessage  = \"Sensor de Temperatura do painel em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature < 40 || temperature > 60){\n    var alertMessage  = \"A temperatura do painel está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };        \n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580630-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Painel Temperature",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1319,
        "layoutY" : 359
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580631-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1601,
        "layoutY" : 361
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9582d40-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme Painel",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 454
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus1 = msg.currentPhase01_A_status;\nvar isolatedStatus2 = msg.currentPhase02_A_status;\nvar isolatedStatus3 = msg.currentPhase03_A_status;\n\nvar Phase01 = msg.currentPhase01_A;\nvar Phase02 = msg.currentPhase02_A;\nvar Phase03 = msg.currentPhase03_A;\n\nvar temperature     = msg.temperatureInternal;\nvar alarmType       = \"Alertas de fases\";\nvar alertMessage    = \"Correntes do motor: \" \n                     + (parseFloat(Phase01) / 1000.0).toFixed(1) + \"A, \"\n                     + (parseFloat(Phase02) / 1000.0).toFixed(1) + \"A, \"\n                     + (parseFloat(Phase03) / 1000.0).toFixed(1) + \"A\";\n\n\nif (isolatedStatus1 != \"OK\" || isolatedStatus2 != \"OK\" || isolatedStatus3 != \"OK\" ) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a0-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 455
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a1-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 455
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a2-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 554
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.flowSensor_l_per_min_status;\nvar flow_per_min   = msg.flowSensor_l_per_min_instantly;\nvar flow_min_last  = msg.flowSensor_l_per_min_lastMinute; \nvar flow_last_15   = msg.flowSensor_l_per_min_last15Minutes; \n\nisolatedStatus = \"ALERTA\";\n\n    if(flow_per_min == 0 && flow_min_last == 0 && flow_last_15 == 0 ){\n        var alarmType      = \"Falta de água\";\n        var message        = \"Possivel falta, fluxo de água em \" + flow_per_min + \" l/min\";\n        var alarmCount     = true;\n        var isolatedStatus = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: message,\n            alarmType: alarmType,\n            alarmCount: alarmCount\n        };   \n    }else if (flow_per_min > 10){\n        var alarmType      = \"Vazão excessiva de água\";\n        var message        = \"Fluxo de água em \" + flow_per_min + \" l/min\";\n        var isolatedStatus = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: message,\n            alarmType: alarmType,\n        };   \n    }\n     \n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d0-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 555
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n        return true;\n}else{\n    return false;\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d1-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 554
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d2-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 653
      },
      "configuration" : {
        "jsScript" : "var currentWeight_kg = msg.currentWeight_kg;\nvar alarmType        = \"Excesso de peso\";\nvar alertMessage     = \"Peso atual em : \" + currentWeight_kg + \"Kg\";\nvar deviceName       = metadata.deviceName; // Obtém o valor do campo deviceName\nvar modeldevice      = deviceName.substring(0, 3); // Pega os 3 primeiros caracteres\nvar limit            = parseInt(modeldevice) + (parseInt(modeldevice)*0.2);//limit= modelo do equipamento + 20%\n\nif (currentWeight_kg > limit) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6920-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 654
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6921-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 654
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6922-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2432,
        "layoutY" : 378
      },
      "configuration" : {
        "ruleChainId" : "10ceb940-4363-11ed-b66e-bd8d8d68617d"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "df18c560-6212-11ee-9559-2f8be92bafca"
      },
      "name" : "ToEmail",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2094,
        "layoutY" : 377
      },
      "configuration" : {
        "jsScript" : "var elapsedMillis = msg.endTs - msg.startTs;\nvar elapsedMinutes = Math.floor(elapsedMillis / (1000 * 60));\n\n\nmsg.currentTime = elapsedMinutes;\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "95750940-6213-11ee-9559-2f8be92bafca"
      },
      "name" : "Count Time",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1026,
        "layoutY" : 755
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.doorSensor_status;\nvar stateDoor      = msg.doorSensor;\nvar alarmType      = \"PORTA ABERTA\";\n\nif (isolatedStatus != \"OK\" ) {\n    var alertMessage  = \"Sensor de porta em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType\n    };\n    msg.startCount= false;\n}\n\n\nif (stateDoor != \"CLOSED\"){\n    var alertMessage  = \"A Porta do equipamento em ALERTA: \" + stateDoor;\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n    \n    msg.startCount= true;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb40040-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 755
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42750-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1864,
        "layoutY" : 754
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42751-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2197,
        "layoutY" : 834
      },
      "configuration" : {
        "jsScript" : "var elapsedMillis = msg.endTs - msg.startTs;\nvar elapsedMinutes = Math.floor(elapsedMillis / (1000 * 60));\n\n\nmsg.currentTime = elapsedMinutes;\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5394cbc0-6220-11ee-9559-2f8be92bafca"
      },
      "name" : "Count Time",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 754
      },
      "configuration" : {
        "jsScript" : "if (msg.startCount == false){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0aa43300-6221-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2431,
        "layoutY" : 478
      },
      "configuration" : {
        "version" : 0
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "228e1ba0-6223-11ee-9559-2f8be92bafca"
      },
      "name" : "Limpo",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.flow.TbAckNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1862,
        "layoutY" : 832
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2ae76e70-622b-11ee-9559-2f8be92bafca"
      },
      "name" : "Pre alarm Porta",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2439,
        "layoutY" : 703
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1, time: msg.currentTime };\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[name]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "82189c60-622f-11ee-9559-2f8be92bafca"
      },
      "name" : "Pre alarm Porta",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2446,
        "layoutY" : 834
      },
      "configuration" : {
        "jsScript" : "if (msg.currentTime > 30){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2c2d9d80-6240-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 836
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "PORTA ABERTA"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "66dd00a0-6241-11ee-9559-2f8be92bafca"
      },
      "name" : "Clear alarm Door",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 55
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.motor_status;\r\nvar state          = msg.motor;\r\nvar alarmType      = \"Possivel problema no motor\";\r\n\r\n\r\n\r\nif (isolatedStatus != \"OK\") {\r\n    var alertMessage  = \"Motor apresenta falha, verificar !\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed070-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 54
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed071-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 53
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed072-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}