{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "1c02c400-4363-11ed-b66e-bd8d8d68617d"
    },
    "name" : "ECOPRO Alarms",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 30,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 38,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 39,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 40,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 41,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 42,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 47,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 48,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 49,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 54,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 3,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 2,
      "type" : "True"
    }, {
      "fromIndex" : 4,
      "toIndex" : 32,
      "type" : "False"
    }, {
      "fromIndex" : 5,
      "toIndex" : 6,
      "type" : "True"
    }, {
      "fromIndex" : 5,
      "toIndex" : 33,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 34,
      "type" : "False"
    }, {
      "fromIndex" : 9,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 10,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "True"
    }, {
      "fromIndex" : 11,
      "toIndex" : 35,
      "type" : "False"
    }, {
      "fromIndex" : 12,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 13,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "True"
    }, {
      "fromIndex" : 14,
      "toIndex" : 36,
      "type" : "False"
    }, {
      "fromIndex" : 15,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 16,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "True"
    }, {
      "fromIndex" : 17,
      "toIndex" : 37,
      "type" : "False"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 20,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 23,
      "type" : "False"
    }, {
      "fromIndex" : 21,
      "toIndex" : 27,
      "type" : "False"
    }, {
      "fromIndex" : 21,
      "toIndex" : 28,
      "type" : "True"
    }, {
      "fromIndex" : 22,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 24,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 26,
      "toIndex" : 25,
      "type" : "True"
    }, {
      "fromIndex" : 26,
      "toIndex" : 31,
      "type" : "False"
    }, {
      "fromIndex" : 27,
      "toIndex" : 22,
      "type" : "True"
    }, {
      "fromIndex" : 27,
      "toIndex" : 29,
      "type" : "False"
    }, {
      "fromIndex" : 28,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 30,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 38,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 39,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 40,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 41,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 42,
      "toIndex" : 24,
      "type" : "Success"
    }, {
      "fromIndex" : 43,
      "toIndex" : 44,
      "type" : "Success"
    }, {
      "fromIndex" : 44,
      "toIndex" : 45,
      "type" : "True"
    }, {
      "fromIndex" : 44,
      "toIndex" : 46,
      "type" : "False"
    }, {
      "fromIndex" : 45,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 47,
      "toIndex" : 43,
      "type" : "Success"
    }, {
      "fromIndex" : 48,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 49,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 50,
      "toIndex" : 51,
      "type" : "Success"
    }, {
      "fromIndex" : 51,
      "toIndex" : 52,
      "type" : "True"
    }, {
      "fromIndex" : 51,
      "toIndex" : 53,
      "type" : "False"
    }, {
      "fromIndex" : 52,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 54,
      "toIndex" : 50,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 1,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1027,
        "layoutY" : 153
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var SensorStatus   = msg.temperatureWater_status;\r\nvar temperature    = msg.temperatureWater;\r\nvar alarmType      = \"Temperatura da agua\";\r\nvar message        = \"Temperatura da agua em \" + temperature + \"°C\";\r\n\r\n// Função para calcular a diferença de tempo em minutos\r\nfunction calcularDiferencaTempoEmMinutos(data) {\r\n    var primeiraData = data[0].ts; // Primeiro timestamp\r\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\r\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\r\n    return diferencaEmMinutos;\r\n}\r\n\r\n// Função para verificar se todos os valores são \"OPEN\"\r\nfunction todosSao(data, diferente) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value == diferente) {\r\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\n// Função para verificar se todos os valores são \"OPEN\"\r\nfunction todosSaoMaior(data, maior) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value < maior) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\n// Função para verificar se todos os valores são \"OPEN\"\r\nfunction todosSaoMenor(data, menor) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value > menor) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\nvar temperaturedelta   = JSON.parse(metadata.temperatureWater);\r\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(temperaturedelta);\r\nvar todosSaoMaior      = todosSaoMaior(temperaturedelta, 50);\r\nvar todosSaoMenor      = todosSaoMenor(temperaturedelta, 20);\r\n\r\nvar statusdelta              = JSON.parse(metadata.temperatureWater_status);\r\nvar diferencaEmMinutosstatus = calcularDiferencaTempoEmMinutos(statusdelta); \r\nvar todosdiferente           = todosSao(statusdelta, \"OK\")\r\n\r\nvar tamanho = statusdelta.length;\r\n\r\nif (tamanho > 25){\r\n\r\nif (temperature > 50 && todosSaoMaior){\r\n    var alertMessage  = \"A temperatura da água está ALTA há \"+ diferencaEmMinutos + \" min.\" + temperature + \"°C \";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };        \r\n}\r\n\r\nif (temperature < 20 && todosSaoMenor){\r\n    var alertMessage  = \"A temperatura da água está BAIXA há \"+ diferencaEmMinutos + \" min.\" + temperature + \"°C \";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };        \r\n}\r\nif (SensorStatus != \"OK\" && todosdiferente) {\r\n    var alertMessage  = \"Sensor de Temperatura da água em alerta há \" + diferencaEmMinutosstatus + \" minutos\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\n}\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "89943d90-5d4e-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 286,
        "layoutY" : 153
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
      },
      "name" : "filter",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 154
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b7266050-5e0f-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme agua",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 253
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var SensorStatus   = msg.temperatureDrum_status;\r\nvar temperature    = msg.temperatureDrum;\r\nvar alarmType      = \"Temperatura do tambor\";\r\n\r\nfunction calcularDiferencaTempoEmMinutos(data) {\r\n    var primeiraData = data[0].ts; // Primeiro timestamp\r\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\r\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\r\n    return diferencaEmMinutos;\r\n}\r\n\r\nfunction todosSao(data, diferente) {\r\nvar allOk = statusdelta.every(function(item) {\r\n    return item.value !== diferente;\r\n});\r\nreturn allOk;\r\n}\r\n\r\nfunction todosSaoMaior(data, maior) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value < maior) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; \r\n}\r\n\r\nfunction todosSaoMenor(data, menor) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value > menor) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\nvar temperaturedelta   = JSON.parse(metadata.temperatureDrum);\r\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(temperaturedelta);\r\nvar todosSaoMaior      = todosSaoMaior(temperaturedelta, 50);\r\nvar todosSaoMenor      = todosSaoMenor(temperaturedelta, 25);\r\n\r\nvar statusdelta              = JSON.parse(metadata.temperatureDrum_status);\r\nvar diferencaEmMinutosstatus = calcularDiferencaTempoEmMinutos(statusdelta); \r\nvar todosdiferente           = todosSao(statusdelta, \"OK\")\r\n\r\n\r\nvar tamanho = statusdelta.length;\r\n\r\nif (tamanho > 25){\r\n\r\nif (temperature > 50 && todosSaoMaior){\r\n    var alertMessage  = \"A temperatura do tambor está ALTA há \"+ diferencaEmMinutos + \" min.\" + temperature + \"°C \";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };        \r\n}\r\n\r\nif (temperature < 25 && todosSaoMenor){\r\n    var alertMessage  = \"A temperatura do tambor está BAIXA há \"+ diferencaEmMinutos + \" min.\" + temperature + \"°C \";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };        \r\n}\r\nif (SensorStatus != \"OK\" && todosdiferente) {\r\n    var alertMessage  = \"Sensor de Temperatura do tambor em alerta há \" + diferencaEmMinutosstatus + \" minutos\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\n}\r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03837c90-612f-11ee-9559-2f8be92bafca"
      },
      "name" : "Drum Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 155
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a070c1a0-6131-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1316,
        "layoutY" : 254
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a85c8260-6135-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 254
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "08b39860-6136-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme tambor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 354
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var SensorStatus   = msg.temperatureInternal_status;\nvar temperature    = msg.temperatureInternal;\nvar alarmType      = \"Temperatura do painel\";\n\n\n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSao(data, diferente) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value == diferente) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"x\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSaoMaior(data, maior) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value < maior) {\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar temperaturedelta   = JSON.parse(metadata.temperatureInternal);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(temperaturedelta);\nvar todosSaoMaior      = todosSaoMaior(temperaturedelta, 65);\n\nvar statusdelta              = JSON.parse(metadata.temperatureInternal_status);\nvar diferencaEmMinutosstatus = calcularDiferencaTempoEmMinutos(statusdelta); \nvar todosdiferente           = todosSao(statusdelta, \"OK\")\n\n\nvar tamanho = statusdelta.length;\n\nif (tamanho > 25){\n\n\nif (temperature > 65 && todosSaoMaior){\n    var alertMessage  = \"A temperatura do painel está em ALERTA há \"+ diferencaEmMinutos + \" min.\" + temperature + \"°C \";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };        \n}\n\nif (SensorStatus != \"OK\" && todosdiferente) {\n    var alertMessage  = \"Sensor de Temperatura do painel em alerta há \" + diferencaEmMinutosstatus + \" minutos\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580630-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Painel Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1319,
        "layoutY" : 359
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580631-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 354
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9582d40-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme Painel",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 454
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus1 = msg.currentPhase01_A_status;\nvar isolatedStatus2 = msg.currentPhase02_A_status;\nvar isolatedStatus3 = msg.currentPhase03_A_status;\n\nvar Phase01 = parseFloat(msg.currentPhase01_A)/1000.0;\nvar Phase02 = parseFloat(msg.currentPhase02_A)/1000.0;\nvar Phase03 = parseFloat(msg.currentPhase03_A)/1000.0;\n\nvar currentWeight_kg = msg.currentWeight_kg;\nvar deviceName       = metadata.deviceName; // Obtém o valor do campo deviceName\n\n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSao(data, estado) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== estado) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nfunction maiorQue(data, valor){\n        for (var i = 0; i < data.length; i++) {\n        var value = parseFloat(data[i].value)/1000.0    \n        if (value < valor) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar mPhase01 = JSON.parse(metadata.currentPhase01_A);\nvar mPhase02 = JSON.parse(metadata.currentPhase02_A);\nvar mPhase03 = JSON.parse(metadata.currentPhase03_A);\n\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(mPhase01);\nvar m01 = maiorQue(mPhase01, 9);\nvar m02 = maiorQue(mPhase02, 9);\nvar m03 = maiorQue(mPhase03, 9);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = m01;\n\n\nvar tamanho = mPhase01.length;\n\nif (tamanho > 12) {\n\nif (m01 || m02 || m03){\n        var alarmType    = \"Alertas de fases\";\n        var message      = \"Correntes do motor: \" \n                     + Phase01.toFixed(1) + \"A, \"\n                     + Phase02.toFixed(1) + \"A, \"\n                     + Phase03.toFixed(1) + \"A\"\n                     + \" á \" + diferencaEmMinutos+\"min\";\n        var Status       = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n}\n\n\nif (isolatedStatus1 != \"OK\" || isolatedStatus2 != \"OK\" || isolatedStatus3 != \"OK\"){\n        var alarmType    = \"Alertas de fases\";\n        var message      = \"Sensor de corrente com problema, verifique\"; \n        var Status       = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };      \n}\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a0-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 455
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a1-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 455
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a2-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1031,
        "layoutY" : 554
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.flowSensor_l_per_min_status;\nvar flow_per_min   = msg.flowSensor_l_per_min_instantly;\nvar flow_min_last  = msg.flowSensor_l_per_min_lastMinute; \nvar flow_last_15   = msg.flowSensor_l_per_min_last15Minutes; \n\n\n     \n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSaoZerados(data) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== 0) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar deltadoor          = JSON.parse(metadata.flowSensor_l_per_min_last15Minutes);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltadoor);\nvar todosSaoZerados    = todosSaoZerados(deltadoor);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = todosSaoZerados;\n\nvar tamanho = deltadoor.length;\n\nif (tamanho > 18){\n\nif(flow_per_min == 0 && flow_min_last == 0 && flow_last_15 == 0 && todosSaoZerados){\n        var alarmType      = \"Falta de água\";\n        var message        = \"Possivel falta, fluxo de água em \" + flow_per_min + \" l/min há \" + diferencaEmMinutos + \"Min. \";\n        var alarmCount     = true;\n        var Status = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n            alarmCount: alarmCount\n        };   \n}else if (flow_per_min > 20){\n        var alarmType      = \"Vazão excessiva de água\";\n        var message        = \"Fluxo de água em \" + flow_per_min + \" l/min\";\n        var Status = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n}\n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d0-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 555
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n        return true;\n}else{\n    return false;\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d1-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 554
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d2-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 653
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var currentWeight_kg = msg.currentWeight_kg;\nvar deviceName       = metadata.deviceName; // Obtém o valor do campo deviceName\nvar modeldevice      = deviceName.substring(0, 3); // Pega os 3 primeiros caracteres\nvar limit            = parseInt(modeldevice) + (parseInt(modeldevice)*0.2);//limit= modelo do equipamento + 20%\n\nfunction PesoAumentando(data) {\nvar aumentando = true;\n\nfor (var i = 1; i < data.length; i++) {\n  if (data[i].value <= data[i - 1].value) {\n    aumentando = false;\n    break;\n  }\n}\n\nreturn aumentando;\n}\n     \n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSao(data, estado) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== estado) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nfunction maiorQue(data, valor){\n        for (var i = 0; i < data.length; i++) {\n        if (data[i].value < valor) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar deltaweight = JSON.parse(metadata.currentWeight_kg);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltaweight);\nvar maior = maiorQue(deltaweight, limit);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = maior;\n\nvar tamanho = deltaweight.length;\n\nif (tamanho > 10){\n\nif (maior){\n        var alarmType    = \"Excesso de peso\";\n        var message      = \"Peso atual em : \" + currentWeight_kg + \"Kg á \" + diferencaEmMinutos+\"min\";\n        var Status       = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n}\n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6920-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 654
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6921-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 653
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "alarmDetailsBuildTbel" : null,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6922-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2448,
        "layoutY" : 55
      },
      "configuration" : {
        "ruleChainId" : "10ceb940-4363-11ed-b66e-bd8d8d68617d"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "df18c560-6212-11ee-9559-2f8be92bafca"
      },
      "name" : "ToEmail",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 753
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.doorSensor_status;\nvar stateDoor      = msg.doorSensor;\nvar alarmType;\nvar status         = \"ALERTA\";\n\n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSaoOPEN(data) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== \"OPEN\") {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar deltadoor          = JSON.parse(metadata.doorSensor);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltadoor);\nvar todosOPEN          = todosSaoOPEN(deltadoor);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = todosOPEN;\n\n\nvar tamanho = deltadoor.length;\n\nif (tamanho > 10){\n\nif (isolatedStatus.trim() != \"OK\" ) {\n    var alertMessage  = \"Sensor de porta em alerta\";\n    alarmType = \"SENSOR REPORTOU PROBLEMA\";\n    msg.status = {\n        errorStatus: status,\n        message: alertMessage,\n        alarmType: alarmType\n    };\n    msg.sensorproblem= true;\n}\n\n\nif (stateDoor.trim() != \"CLOSED\" && todosOPEN){\n    var alertMessage  = \"A Porta do equipamento em ALERTA: \" + stateDoor + \" há \" + diferencaEmMinutos+ \" Minutos\";\n    alarmType = \"PORTA ABERTA\";\n    msg.status = {\n        errorStatus: status,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n    \n    msg.sensorproblem= false;\n}\n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb40040-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1316,
        "layoutY" : 755
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if (msg.sensorproblem){\n    return true\n}else{\n    return false\n}\n",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42750-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1903,
        "layoutY" : 805
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "alarmDetailsBuildTbel" : null,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "Porta Aberta",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42751-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 855
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : null,
        "alarmType" : "Sensor da Porta"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "66dd00a0-6241-11ee-9559-2f8be92bafca"
      },
      "name" : "Clear alarm Door Sensor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 53
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var SensorStatus   = msg.motor_status;\r\nvar motor          = msg.motor;\r\nvar alarmType      = \"Problema no motor\";\r\n\r\n// Função para calcular a diferença de tempo em minutos\r\nfunction calcularDiferencaTempoEmMinutos(data) {\r\n    var primeiraData = data[0].ts; // Primeiro timestamp\r\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\r\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\r\n    return diferencaEmMinutos;\r\n}\r\n\r\nfunction todosiguais(data, igual) {\r\nvar allOk = data.every(function(item) {\r\n    return item.value === igual;\r\n});\r\nreturn allOk\r\n}\r\n\r\nfunction todosdiferente(data, diferente) {\r\nvar allOk = data.every(function(item) {\r\n    return item.value !== diferente;\r\n});\r\nreturn allOk\r\n}\r\n\r\nfunction todosSaoMaior(data, maior) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value < maior) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\nfunction todosSaoMenor(data, menor) {\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (data[i].value > menor) {\r\n            return false; // Retorna falso se encontrar qualquer valor maior de \"x\"\r\n        }\r\n    }\r\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\r\n}\r\n\r\nvar statusdelta              = JSON.parse(metadata.motor_status);\r\nvar diferencaEmMinutosstatus = calcularDiferencaTempoEmMinutos(statusdelta); \r\nvar todosdiferente           = todosdiferente(statusdelta, \"OK\")\r\n\r\nvar motordelta               = JSON.parse(metadata.motor);\r\nvar diferencaEmMinutos       = calcularDiferencaTempoEmMinutos(motordelta); \r\nvar todosiguais              = todosiguais(motordelta, \"STOPEED\")\r\n\r\nvar tamanho = motordelta.length;\r\n\r\nif (tamanho > 25){\r\n\r\n\r\nif (motor == \"STOPEED\" && todosiguais) {\r\n    var alertMessage  = \"Motor PARADO há \" + diferencaEmMinutosstatus + \" minutos favor verificar\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nif (SensorStatus != \"OK\" && todosdiferente) {\r\n    var alertMessage  = \"Sensor do motor em ALERTA há \" + diferencaEmMinutosstatus + \" minutos favor verificar\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n    \r\n}\r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed070-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 54
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed071-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 53
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed072-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 805
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n",
        "tbelScript" : "return msg.temperature > 20;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f0e9f340-729d-11ee-b282-e7e99d39da5a"
      },
      "name" : "startcount",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 755
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "Sensor da Porta",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7fe3bf70-72a0-11ee-b282-e7e99d39da5a"
      },
      "name" : "Sensor Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1904,
        "layoutY" : 855
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n  details = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  metadata.remove('prevAlarmDetails');\n  //now metadata is the same as it comes IN this rule node\n}\n",
        "alarmType" : "Porta Aberta"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7d447190-72a2-11ee-b282-e7e99d39da5a"
      },
      "name" : "Porta Aberta limpar",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 702,
        "layoutY" : 754
      },
      "configuration" : {
        "latestTsKeyNames" : [ "doorSensor" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 100,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 52,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "95a49d90-8e2d-11ee-a58a-eb4f99e88ddb"
      },
      "name" : "Door validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 103
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Possivel problema no motor"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "23fdade0-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Possivel problema no motor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 204
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Temperatura da agua"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "23fe9840-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Temperatura da agua",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 303
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Temperatura do tambor"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6c87a020-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Temperatura do tambor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 404
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Temperatura do painel"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c4b99910-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Temperatura do painel",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 505
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Alertas de fases"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ddf87540-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Alertas de fases",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 605
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Falta de água"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1437a270-8f9a-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Falta de água",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1604,
        "layoutY" : 705
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Excesso de peso"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3af95b60-8f9a-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Excesso de peso",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 703,
        "layoutY" : 554
      },
      "configuration" : {
        "latestTsKeyNames" : [ "flowSensor_l_per_min_last15Minutes" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 25,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "327497b0-8fd2-11ee-83df-a5eef814d8ab"
      },
      "name" : "Water floor validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 701,
        "layoutY" : 352
      },
      "configuration" : {
        "latestTsKeyNames" : [ "temperatureInternal", "temperatureInternal_status" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 32,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ed33d000-9060-11ee-83df-a5eef814d8ab"
      },
      "name" : "Painel validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 700,
        "layoutY" : 155
      },
      "configuration" : {
        "latestTsKeyNames" : [ "temperatureWater_status", "temperatureWater" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 32,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "66332eb0-92aa-11ee-8101-79ea8fed56f2"
      },
      "name" : "Water validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 702,
        "layoutY" : 252
      },
      "configuration" : {
        "latestTsKeyNames" : [ "temperatureDrum_status", "temperatureDrum" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 32,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6b0ad1a0-92ae-11ee-8101-79ea8fed56f2"
      },
      "name" : "Drum validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 702,
        "layoutY" : 52
      },
      "configuration" : {
        "latestTsKeyNames" : [ "motor_status", "motor" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 32,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "93664090-92b2-11ee-8101-79ea8fed56f2"
      },
      "name" : "Motor validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1034,
        "layoutY" : 904
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nfunction PesoAumentando(data) {\nvar aumentando = true;\n\nfor (var i = 1; i < data.length; i++) {\n  if (data[i].value <= data[i - 1].value) {\n    aumentando = false;\n    break;\n  }\n}\n\nreturn aumentando;\n}\n     \n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSao(data, estado) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== estado) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\n\nvar deltadoor          = JSON.parse(metadata.doorSensor);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltadoor);\nvar todosSao           = todosSao(deltadoor, 'CLOSED');\n\nvar deltaweight = JSON.parse(metadata.currentWeight_kg);\nvar aumentando  = PesoAumentando(deltaweight);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = todosSao;\n\nvar tamanho = deltadoor.length;\n\nif (tamanho > 10){\n\nif (todosSao && aumentando){\n        var alarmType = \"Possível entupimento\";\n        var message   = \"O peso do equipamento esta aumentando a \" + diferencaEmMinutos + \"min\";\n        var Status    = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n}\n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3ccf3290-99bb-11ee-be18-0d517bebc8bd"
      },
      "name" : "Clogging",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 905
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n        return true;\n}else{\n    return false;\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3cd3c670-99bb-11ee-be18-0d517bebc8bd"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 904
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3cd4d7e0-99bb-11ee-be18-0d517bebc8bd"
      },
      "name" : "Clogging",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 954
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Possível entupimento"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3cd59b30-99bb-11ee-be18-0d517bebc8bd"
      },
      "name" : "Clogging",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 706,
        "layoutY" : 904
      },
      "configuration" : {
        "latestTsKeyNames" : [ "doorSensor", "currentWeight_kg" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 52,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3cd65e80-99bb-11ee-be18-0d517bebc8bd"
      },
      "name" : "Clogging validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 703,
        "layoutY" : 654
      },
      "configuration" : {
        "latestTsKeyNames" : [ "currentWeight_kg" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 32,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1d95e7e0-9ea5-11ee-854d-7358fe2b0936"
      },
      "name" : "Overweight validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 700,
        "layoutY" : 452
      },
      "configuration" : {
        "latestTsKeyNames" : [ "currentPhase01_A", "currentPhase02_A", "currentPhase03_A" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 15,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e072710-9ea8-11ee-854d-7358fe2b0936"
      },
      "name" : "Current validation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1032,
        "layoutY" : 1005
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var totalWaterUsage_l = msg.totalWaterUsage_l;\nvar deviceName        = metadata.deviceName; // Obtém o valor do campo deviceName\nvar modeldevice       = deviceName.substring(0, 3); // Pega os 3 primeiros caracteres\nvar minimo             = modeldevice * 4;\n\nfunction PesoAumentando(data) {\nvar aumentando = true;\n\nfor (var i = 1; i < data.length; i++) {\n  if (data[i].value <= data[i - 1].value) {\n    aumentando = false;\n    break;\n  }\n}\n\nreturn aumentando;\n}\n     \n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaDeLitros(data) {\n    var primeiraData    = data[0].value; // Primeiro timestamp\n    var ultimaData      = data[data.length - 1].value; // Último timestamp\n    var diferencaLitros = ultimaData - primeiraData; // Calcula a diferença em minutos\n    return diferencaLitros;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSao(data, estado) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== estado) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nfunction maiorQue(data, valor){\n        for (var i = 0; i < data.length; i++) {\n        if (data[i].value < valor) {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar deltawater         = JSON.parse(metadata.totalWaterUsage_l);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltawater);\nvar diferencaLitros    = totalWaterUsage_l - deltawater;//calcularDiferencaDeLitros(deltawater);\n\nmsg.diferencaLitros = diferencaLitros;\nmsg.minimo = minimo;\n\nif (diferencaLitros < 0){\n    diferencaLitros = 0;\n}\n\nif (diferencaLitros < minimo){\n        var alarmType    = \"Baixo consumo de água\";\n        var message      = \"Quantidade de água em litros utilizados nas ultimas 24h : \" + diferencaLitros + \"l, minimo: \" + minimo;\n        var Status       = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b39f50b0-a4c1-11ee-b098-ab1d363d953b"
      },
      "name" : "Water consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1323,
        "layoutY" : 1006
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b3a4cef0-a4c1-11ee-b098-ab1d363d953b"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1604,
        "layoutY" : 1004
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "alarmDetailsBuildTbel" : null,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b3a6cac0-a4c1-11ee-b098-ab1d363d953b"
      },
      "name" : "Water consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1604,
        "layoutY" : 1054
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Baixo consumo de água"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b3a7b520-a4c1-11ee-b098-ab1d363d953b"
      },
      "name" : "Water consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 706,
        "layoutY" : 1006
      },
      "configuration" : {
        "latestTsKeyNames" : [ "totalWaterUsage_l" ],
        "aggregation" : "NONE",
        "fetchMode" : "FIRST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 24,
        "startIntervalTimeUnit" : "HOURS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b3a9ff10-a4c1-11ee-b098-ab1d363d953b"
      },
      "name" : "Daily water consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}