{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "1c02c400-4363-11ed-b66e-bd8d8d68617d"
    },
    "name" : "ECOPRO Alarms",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 0,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 3,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 7,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 10,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 13,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 16,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 24,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 1,
      "toIndex" : 30,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 3,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 2,
      "type" : "True"
    }, {
      "fromIndex" : 4,
      "toIndex" : 32,
      "type" : "False"
    }, {
      "fromIndex" : 5,
      "toIndex" : 6,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "True"
    }, {
      "fromIndex" : 9,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 10,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "True"
    }, {
      "fromIndex" : 12,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 13,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "True"
    }, {
      "fromIndex" : 15,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 16,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "True"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 20,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 23,
      "type" : "False"
    }, {
      "fromIndex" : 21,
      "toIndex" : 27,
      "type" : "False"
    }, {
      "fromIndex" : 21,
      "toIndex" : 28,
      "type" : "True"
    }, {
      "fromIndex" : 22,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 24,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 26,
      "toIndex" : 25,
      "type" : "True"
    }, {
      "fromIndex" : 26,
      "toIndex" : 31,
      "type" : "False"
    }, {
      "fromIndex" : 27,
      "toIndex" : 22,
      "type" : "True"
    }, {
      "fromIndex" : 27,
      "toIndex" : 29,
      "type" : "False"
    }, {
      "fromIndex" : 28,
      "toIndex" : 19,
      "type" : "Created"
    }, {
      "fromIndex" : 30,
      "toIndex" : 20,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 1,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1027,
        "layoutY" : 153
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.temperatureWater_status;\r\nvar temperature    = msg.temperatureWater;\r\nvar alarmType      = \"Temperatura da agua\";\r\nvar message        = \"Temperatura da agua em \" + temperature + \"°C\";\r\n\r\n\r\nif (isolatedStatus != \"OK\") {\r\n    var alertMessage  = \"Sensor de Temperatura em alerta\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nif (temperature < 20 || temperature > 50){\r\n    var alertMessage  = \"A temperatura da água está em ALERTA: \" + temperature + \"°C\";\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}  \r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "89943d90-5d4e-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 289,
        "layoutY" : 148
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad2e0c50-5d7f-11ee-9559-2f8be92bafca"
      },
      "name" : "filter",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 154
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b7266050-5e0f-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme agua",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 253
      },
      "configuration" : {
        "jsScript" : "var isolatedStatus = msg.temperatureDrum_status;\nvar temperature    = msg.temperatureDrum;\nvar alarmType      = \"Temperatura do tambor\";\nvar message        = \"Temperatura do tambor em \" + temperature + \"°C\";\n\n\n\nif (isolatedStatus != \"OK\" && temperature > 25 && temperature < 50) {\n    var alertMessage  = \"Sensor de Temperatura do tambor em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature < 25 || temperature > 50){\n    var alertMessage  = \"A temperatura do tambor está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03837c90-612f-11ee-9559-2f8be92bafca"
      },
      "name" : "Drum Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 155
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a070c1a0-6131-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1318,
        "layoutY" : 258
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a85c8260-6135-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 260
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "08b39860-6136-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme tambor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 354
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.temperatureInternal_status;\nvar temperature    = msg.temperatureInternal;\nvar alarmType      = \"Temperatura do painel\";\n\nif (isolatedStatus != \"OK\") {\n    var alertMessage  = \"Sensor de Temperatura do painel em alerta\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };\n}\n\n\nif (temperature > 65){\n    var alertMessage  = \"A temperatura do painel está em ALERTA: \" + temperature + \"°C\";\n    var isolatedStatus = \"ALERTA\";\n\n    msg.status = {\n        errorStatus: isolatedStatus,\n        message: alertMessage,\n        alarmType: alarmType,\n    };        \n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580630-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Painel Temperature",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1319,
        "layoutY" : 359
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9580631-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1601,
        "layoutY" : 361
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f9582d40-6144-11ee-9559-2f8be92bafca"
      },
      "name" : "Alarme Painel",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 454
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus1 = msg.currentPhase01_A_status;\nvar isolatedStatus2 = msg.currentPhase02_A_status;\nvar isolatedStatus3 = msg.currentPhase03_A_status;\n\nvar Phase01 = parseFloat(msg.currentPhase01_A)/1000.0;\nvar Phase02 = parseFloat(msg.currentPhase02_A)/1000.0;\nvar Phase03 = parseFloat(msg.currentPhase03_A)/1000.0;\n\nvar temperature     = msg.temperatureInternal;\nvar alarmType       = \"Alertas de fases\";\nvar alertMessage    = \"Correntes do motor: \" \n                     + Phase01.toFixed(1) + \"A, \"\n                     + Phase02.toFixed(1) + \"A, \"\n                     + Phase03.toFixed(1) + \"A\";\n\n\nif (isolatedStatus1 != \"OK\" || isolatedStatus2 != \"OK\" || isolatedStatus3 != \"OK\" ||\n    Phase01 > 9 || Phase02 > 9 || Phase03 > 9\n) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a0-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 455
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a1-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 455
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "168a03a2-6147-11ee-9559-2f8be92bafca"
      },
      "name" : "Current Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1031,
        "layoutY" : 554
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.flowSensor_l_per_min_status;\nvar flow_per_min   = msg.flowSensor_l_per_min_instantly;\nvar flow_min_last  = msg.flowSensor_l_per_min_lastMinute; \nvar flow_last_15   = msg.flowSensor_l_per_min_last15Minutes; \n\n\n\n    if(flow_per_min == 0 && flow_min_last == 0 && flow_last_15 == 0 ){\n        var alarmType      = \"Falta de água\";\n        var message        = \"Possivel falta, fluxo de água em \" + flow_per_min + \" l/min\";\n        var alarmCount     = true;\n        var Status = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n            alarmCount: alarmCount\n        };   \n    }else if (flow_per_min > 20){\n        var alarmType      = \"Vazão excessiva de água\";\n        var message        = \"Fluxo de água em \" + flow_per_min + \" l/min\";\n        var Status = \"ALERTA\";\n    \n        msg.status = {\n            errorStatus: Status,\n            message: message,\n            alarmType: alarmType,\n        };   \n    }\n     \n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d0-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 555
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n        return true;\n}else{\n    return false;\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d1-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 554
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ad3c02d2-6160-11ee-9559-2f8be92bafca"
      },
      "name" : "Water Flow Evaluation",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 653
      },
      "configuration" : {
        "jsScript" : "var currentWeight_kg = msg.currentWeight_kg;\nvar alarmType        = \"Excesso de peso\";\nvar alertMessage     = \"Peso atual em : \" + currentWeight_kg + \"Kg\";\nvar deviceName       = metadata.deviceName; // Obtém o valor do campo deviceName\nvar modeldevice      = deviceName.substring(0, 3); // Pega os 3 primeiros caracteres\nvar limit            = parseInt(modeldevice) + (parseInt(modeldevice)*0.2);//limit= modelo do equipamento + 20%\n\nif (currentWeight_kg > limit) {\n        var isolatedStatus = \"ALERTA\";\n\n        msg.status = {\n            errorStatus: isolatedStatus,\n            message: alertMessage,\n            alarmType: alarmType,\n        };        \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6920-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 654
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6921-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 653
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "alarmDetailsBuildTbel" : null,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "$[status.alarmType]",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa6922-6163-11ee-9559-2f8be92bafca"
      },
      "name" : "Overweight",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2448,
        "layoutY" : 55
      },
      "configuration" : {
        "ruleChainId" : "10ceb940-4363-11ed-b66e-bd8d8d68617d"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "df18c560-6212-11ee-9559-2f8be92bafca"
      },
      "name" : "ToEmail",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1029,
        "layoutY" : 753
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.doorSensor_status;\nvar stateDoor      = msg.doorSensor;\nvar alarmType;\nvar status         = \"ALERTA\";\n\n// Função para calcular a diferença de tempo em minutos\nfunction calcularDiferencaTempoEmMinutos(data) {\n    var primeiraData = data[0].ts; // Primeiro timestamp\n    var ultimaData = data[data.length - 1].ts; // Último timestamp\n    var diferencaEmMinutos = (ultimaData - primeiraData) / (1000 * 60); // Calcula a diferença em minutos\n    return diferencaEmMinutos;\n}\n\n// Função para verificar se todos os valores são \"OPEN\"\nfunction todosSaoOPEN(data) {\n    for (var i = 0; i < data.length; i++) {\n        if (data[i].value !== \"OPEN\") {\n            return false; // Retorna falso se encontrar qualquer valor diferente de \"OPEN\"\n        }\n    }\n    return true; // Retorna verdadeiro se todos os valores forem \"OPEN\"\n}\n\nvar deltadoor          = JSON.parse(metadata.doorSensor);\nvar diferencaEmMinutos = calcularDiferencaTempoEmMinutos(deltadoor);\nvar todosOPEN          = todosSaoOPEN(deltadoor);\n\nmsg.deltadoor = diferencaEmMinutos;\nmsg.disparar  = todosOPEN;\n\nif (isolatedStatus.trim() != \"OK\" ) {\n    var alertMessage  = \"Sensor de porta em alerta\";\n    alarmType = \"SENSOR REPORTOU PROBLEMA\";\n    msg.status = {\n        errorStatus: status,\n        message: alertMessage,\n        alarmType: alarmType\n    };\n    msg.sensorproblem= true;\n}\n\n\nif (stateDoor.trim() != \"CLOSED\" && todosOPEN){\n    var alertMessage  = \"A Porta do equipamento em ALERTA: \" + stateDoor;\n    alarmType = \"PORTA ABERTA\";\n    msg.status = {\n        errorStatus: status,\n        message: alertMessage,\n        alarmType: alarmType\n    };        \n    \n    msg.sensorproblem= false;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb40040-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1316,
        "layoutY" : 755
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if (msg.sensorproblem){\n    return true\n}else{\n    return false\n}\n",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42750-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1926,
        "layoutY" : 817
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n  var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  delete metadata.prevAlarmDetails;\n  if (prevDetails.count) {\n    details.count = prevDetails.count + 1;\n  }\n}\n\nreturn details;\n",
        "alarmDetailsBuildTbel" : null,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "Porta Aberta",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ebb42751-621d-11ee-9559-2f8be92bafca"
      },
      "name" : "Open Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 902
      },
      "configuration" : {
        "scriptLang" : "JS",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : null,
        "alarmType" : "Sensor da Porta"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "66dd00a0-6241-11ee-9559-2f8be92bafca"
      },
      "name" : "Clear alarm Door Sensor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 53
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var isolatedStatus = msg.motor_status;\r\nvar state          = msg.motor;\r\nvar alarmType      = \"Possivel problema no motor\";\r\n\r\n\r\n\r\nif (isolatedStatus != \"OK\") {\r\n    var alertMessage  = \"Motor apresenta falha, verificar estado \"+state;\r\n    var isolatedStatus = \"ALERTA\";\r\n\r\n    msg.status = {\r\n        errorStatus: isolatedStatus,\r\n        message: alertMessage,\r\n        alarmType: alarmType,\r\n    };\r\n}\r\n\r\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed070-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 54
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {status: msg.status, count: 1};\n\nif (metadata.prevAlarmDetails) {\n    var prevDetails = JSON.parse(metadata.prevAlarmDetails);\n    delete metadata.prevAlarmDetails;\n    if (prevDetails.count) {\n        details.count = prevDetails.count + 1;\n    }\n\n  \n}\n\nreturn details;\n",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : true,
        "alarmType" : "$[status.alarmType]",
        "severity" : "INDETERMINATE",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed071-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Motor Error",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1320,
        "layoutY" : 53
      },
      "configuration" : {
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f92ed072-624e-11ee-9559-2f8be92bafca"
      },
      "name" : "Filter status",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 816
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if (msg.status){\n    return true\n}else{\n    return false\n}\n",
        "tbelScript" : "return msg.temperature > 20;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f0e9f340-729d-11ee-b282-e7e99d39da5a"
      },
      "name" : "startcount",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 730
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "alarmType" : "Sensor da Porta",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ],
        "propagateToOwner" : false,
        "propagateToTenant" : false,
        "dynamicSeverity" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7fe3bf70-72a0-11ee-b282-e7e99d39da5a"
      },
      "name" : "Sensor Door",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1927,
        "layoutY" : 912
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n  details = JSON.parse(metadata.prevAlarmDetails);\n  // remove prevAlarmDetails from metadata\n  metadata.remove('prevAlarmDetails');\n  //now metadata is the same as it comes IN this rule node\n}\n",
        "alarmType" : "Porta Aberta"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7d447190-72a2-11ee-b282-e7e99d39da5a"
      },
      "name" : "Porta Aberta limpar",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 567,
        "layoutY" : 753
      },
      "configuration" : {
        "latestTsKeyNames" : [ "doorSensor" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 100,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 2,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "95a49d90-8e2d-11ee-a58a-eb4f99e88ddb"
      },
      "name" : "teste",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1602,
        "layoutY" : 103
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Possivel problema no motor"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "23fdade0-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Possivel problema no motor",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1603,
        "layoutY" : 204
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmType" : "Temperatura da agua"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "23fe9840-8f99-11ee-88bd-b7c2a3c1921f"
      },
      "name" : "Temperatura da agua",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    } ],
    "ruleChainConnections" : null
  },
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}